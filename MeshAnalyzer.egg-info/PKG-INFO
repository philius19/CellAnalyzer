Metadata-Version: 2.4
Name: MeshAnalyzer
Version: 1.0.0
Summary: 3D mesh analysis package for u-shape3D immune cell morphology data
Author-email: Philipp Kaintoch <your.email@example.com>
License: MIT
Project-URL: Homepage, https://github.com/yourusername/MeshAnalyzer
Project-URL: Documentation, https://meshanalyzer.readthedocs.io
Project-URL: Repository, https://github.com/yourusername/MeshAnalyzer.git
Project-URL: Bug Tracker, https://github.com/yourusername/MeshAnalyzer/issues
Keywords: mesh,3d-analysis,microscopy,cell-biology,morphology
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Science/Research
Classifier: Topic :: Scientific/Engineering :: Bio-Informatics
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.20.0
Requires-Dist: scipy>=1.7.0
Requires-Dist: matplotlib>=3.4.0
Requires-Dist: vedo>=2023.4.0
Requires-Dist: mat73>=0.59
Requires-Dist: h5py>=3.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=3.0.0; extra == "dev"
Requires-Dist: black>=22.0.0; extra == "dev"
Requires-Dist: flake8>=4.0.0; extra == "dev"
Requires-Dist: ipython>=8.0.0; extra == "dev"
Requires-Dist: jupyter>=1.0.0; extra == "dev"
Provides-Extra: docs
Requires-Dist: sphinx>=4.0.0; extra == "docs"
Requires-Dist: sphinx-rtd-theme>=1.0.0; extra == "docs"

# MeshAnalyzer

A Python module for quantitative analysis of 3D mesh data generated by u-shape3D, designed for morphological characterization of biological cells from fluorescence microscopy.

## Overview

MeshAnalyzer provides a robust, type-safe framework for analyzing triangulated surface meshes and their associated curvature data. Built specifically for the u-shape3D pipeline, it bridges MATLAB mesh generation with Python's scientific computing ecosystem.

### Key Features

- **Type-Safe Data Structures**: Leverages Python dataclasses for immutable, self-documenting results
- **Comprehensive Mesh Analysis**: Volume, surface area, topology, and quality metrics
- **Curvature Statistics**: Full distribution analysis with percentiles and outlier detection
- **Physical Units**: Automatic conversion from pixels to micrometers
- **Publication-Ready Visualization**: Nature-style plotting with customizable parameters
- **Quality Assurance**: Automatic mesh quality validation and warning system

## Installation

### Prerequisites

```bash
# Required packages
pip install numpy scipy h5py vedo matplotlib
```

### Setup

```bash
# Clone the repository
git clone https://github.com/philius19/bleb3d-pipeline.git
cd bleb3d-pipeline/Scripts

# Import the module
from MeshAnalyzer import MeshAnalyzer
```

## Architecture

### Module Structure

```
MeshAnalyzer/
├── __init__.py          # Package initialization and exports
├── analyzer.py          # Core MeshAnalyzer class
├── datatypes.py         # Type-safe dataclass definitions
├── io.py               # MATLAB file I/O operations
├── utils.py            # Utility functions and calculations
└── visualization.py    # Plotting and visualization tools
```

### Core Components

#### 1. MeshAnalyzer Class (`analyzer.py`)

The central analysis engine that orchestrates data loading, processing, and result generation.

```python
class MeshAnalyzer:
    """
    Analyzes u-shape3D mesh data including surface geometry and curvature.
    
    Key responsibilities:
    - Load and validate mesh/curvature data from MATLAB files
    - Calculate comprehensive statistics
    - Ensure physical unit consistency
    - Provide both modern (dataclass) and legacy (dict) interfaces
    """
```

#### 2. Data Structures (`datatypes.py`)

Type-safe, immutable dataclasses that enforce data integrity:

- **`MeshStatistics`**: Geometric properties (volume, surface area, topology)
- **`CurvatureStatistics`**: Distribution metrics with automatic percentile calculation
- **`QualityMetrics`**: Mesh quality indicators with validation warnings
- **`AnalysisResults`**: Container class with completeness checking

#### 3. I/O Operations (`io.py`)

Handles MATLAB `.mat` file loading with robust error handling:
- Supports both v7.3 (HDF5) and legacy MATLAB formats
- Validates data integrity during loading
- Provides clear error messages for debugging

#### 4. Visualization (`visualization.py`)

Publication-quality plotting with Nature journal styling:
- Curvature distribution analysis
- Spatial mapping of surface properties
- Customizable color schemes and layouts

## Usage

### Basic Analysis Workflow

```python
from MeshAnalyzer import MeshAnalyzer

# Initialize analyzer with pixel sizes
analyzer = MeshAnalyzer(
    surface_path='path/to/surface_1_1.mat',
    curvature_path='path/to/meanCurvature_1_1.mat',
    pixel_size_xy=0.1661,  # 166.1 nm in micrometers
    pixel_size_z=0.5       # 500 nm in micrometers
)

# Load data
analyzer.load_data()

# Calculate statistics
results = analyzer.calculate_statistics()

# Access results with type safety
print(f"Cell Volume: {results.mesh_stats.volume_um3:.2f} μm³")
print(f"Surface Area: {results.mesh_stats.surface_area_um2:.2f} μm²")
print(f"Mean Curvature: {results.curvature_stats.mean:.4f} ± {results.curvature_stats.std:.4f}")

# Check quality
warnings = results.quality_metrics.get_warnings()
if warnings:
    print("Quality Issues:")
    for warning in warnings:
        print(f"  - {warning}")

# Get human-readable summary
print(results.summary())
```

### Advanced Features

#### Context Manager Support

```python
# Automatic resource management
with MeshAnalyzer(surface_path, curvature_path) as analyzer:
    results = analyzer.calculate_statistics()
    # Data automatically loaded within context
```

#### Physical Dimensions

```python
# Get cell dimensions in micrometers
dims = analyzer.physical_dimensions
print(f"Cell size: {dims['x_um']:.1f} × {dims['y_um']:.1f} × {dims['z_um']:.1f} μm")
```

#### Legacy Compatibility

```python
# For existing code expecting dictionaries
stats_dict = analyzer.calculate_statistics_dict()
volume = stats_dict['mesh']['volume_um3']  # Old style still works
```

## Data Flow

```mermaid
graph LR
    A[u-shape3D MATLAB] -->|surface_1_1.mat| B[MeshAnalyzer]
    A -->|meanCurvature_1_1.mat| B
    B --> C[Load & Validate]
    C --> D[Calculate Statistics]
    D --> E[Type-Safe Results]
    E --> F[Visualization/Export]
```

## Scientific Validity

### Curvature Calculation
- Mean curvature computed per face using u-shape3D's validated algorithms
- Sign convention: positive = convex, negative = concave
- Units: 1/pixels or 1/μm depending on analysis stage

### Quality Metrics
- **Aspect Ratio**: Triangle quality indicator (ideal ≈ 1.0)
- **Edge Length Variation**: Mesh uniformity measure
- **Watertight Check**: Ensures closed surface for valid volume calculation

### Statistical Measures
- **Standard Error**: SEM = σ/√n for population estimates
- **Percentiles**: Robust statistics less sensitive to outliers
- **Skewness/Kurtosis**: Distribution shape characterization

## Best Practices

### 1. Always Specify Physical Units
```python
# Correct: Specify pixel sizes for accurate measurements
analyzer = MeshAnalyzer(surface_path, curvature_path, 
                       pixel_size_xy=0.1661, pixel_size_z=0.5)

# Incorrect: Using defaults may give wrong absolute measurements
analyzer = MeshAnalyzer(surface_path, curvature_path)  # ⚠️ Uses default 0.1 μm
```

### 2. Check Data Quality
```python
# Always verify mesh quality before analysis
if not results.mesh_stats.is_watertight:
    print("Warning: Mesh is not closed - volume calculation may be inaccurate")
```

### 3. Use Type-Safe Access
```python
# Good: IDE support, type checking
area = results.mesh_stats.surface_area_um2

# Avoid: No IDE help, prone to typos
area = stats_dict['mesh']['surface_area_um2']
```

## API Reference

### MeshAnalyzer Class

#### Constructor
```python
MeshAnalyzer(surface_path: str, curvature_path: str,
             pixel_size_xy: float = None, pixel_size_z: float = None)
```

#### Methods
- `load_data(verbose: bool = True) -> None`: Load mesh and curvature data
- `calculate_statistics(force_recalculate: bool = False) -> AnalysisResults`: Compute all metrics
- `calculate_statistics_dict() -> Dict`: Legacy dictionary interface

#### Properties
- `is_loaded -> bool`: Check if data has been loaded
- `physical_dimensions -> Dict[str, float]`: Cell dimensions in micrometers

### Data Classes

#### MeshStatistics
```python
@dataclass(frozen=True)
class MeshStatistics:
    n_vertices: int
    n_faces: int
    n_edges: int
    volume_pixels3: float
    volume_um3: float
    surface_area_pixels2: float
    surface_area_um2: float
    is_watertight: bool
    euler_number: int
```

#### CurvatureStatistics
```python
@dataclass(frozen=True)
class CurvatureStatistics:
    mean: float
    std: float
    sem: float
    median: float
    min: float
    max: float
    percentiles: Dict[int, float]
    
    @classmethod
    def from_array(cls, curvature: np.ndarray) -> 'CurvatureStatistics'
```

## Troubleshooting

### Common Issues

1. **FileNotFoundError**: Ensure paths are absolute or relative to current directory
2. **ValueError: Unknown mat file type**: Update to h5py >= 3.0 for v7.3 mat files
3. **Memory Error**: For large meshes (>10M faces), increase available RAM or process in chunks

### Debug Mode

```python
# Enable verbose output for debugging
analyzer.load_data(verbose=True)
quality_metrics = calculate_mesh_quality_metrics(analyzer.mesh, verbose=True)
```

## Contributing

We welcome contributions! Please ensure:
- Type hints for all function parameters and returns
- Docstrings following NumPy style guide
- Unit tests for new functionality
- Backwards compatibility maintained

## License

This module is part of the Bleb3D Pipeline project. See the main repository for license information.

## Citation

If you use MeshAnalyzer in your research, please cite:
```bibtex
@software{meshanalyzer2025,
  title={MeshAnalyzer: A Python Module for Mesh Analysis},
  author={Galic Lab},
  year={2025},
  url={https://github.com/philius19/bleb3d-pipeline}
}
```

## Acknowledgments

Built on top of u-shape3D by the Danuser Lab at UT Southwestern Medical Center. The MeshAnalyzer provides a Python Implementation for extended Data Analysis of the Mesh files 
